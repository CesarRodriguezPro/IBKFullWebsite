
{% extends 'controlapp/base.html' %}

{% block title %}
  {{user.username}}
{% endblock %}

{%  block username_block %}
<a  style="color:#FFDE05;" href="{% url 'foreman_hub:foreman_main' %}">
         <ul class="nav">  
            <li class='nav-link nav-item'><h5> {{request.user.first_name}}</h5></li>
            <li class='nav-item'>last update: {{current_time}}</li>         
          </ul>
          </a>
{% endblock %}

{% block customNav %}
          <li class="nav-item">
              <a class="nav-link active" style="color:#FFDE05;" href="#">{{ current_location_label }}</a>
          </li>
          <li class="nav-item">
                <div class="dropdown">
                      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Downloads
                      </button>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

                        <form method="POST">
                          {% csrf_token %}
                        <button type="submit" class="dropdown-item" name="download_current" >Download Current</button>
                        <button type="submit" class="dropdown-item" name="past_time_sheet" >Last Week TimeSheet</button>
                        <button type="submit" class="dropdown-item" name="current_time_sheet" >Current TimeSheet</button>
                        </form>
                </div>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="{% url 'absentRequest:absent_request' %}">Absent Report</a>
          </li>
          <li class="nav-item">
              <a class="nav-link " href="{% url 'vacationRequest:vacation_request' %}">Vacation Request</a>
          </li>
        <div class="dropdown">
            <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            {{ current_location_label }}
            <span class="caret"></span>
            </button>

                <ul class="dropdown-menu">
                  <form method="POST">
                  {% csrf_token %}
                      <li>
                        <div class="btn-group-vertical">
                          <a class="dropdown-item" href="{% url 'foreman_hub:foreman_main' %}"  name="" >All Locations</a>
                            {% for location in list_locations %}
                              <a  href="{% url 'foreman_hub:foreman_main' %}{{location}}"  class="dropdown-item">{{ location }}</a>
                              {% endfor %}
                        </div>
                    </li>
                  </form>
                </ul>
        </div> 
{% endblock %}


{% block content %}
<!-- Weather code -->
<a class="weatherwidget-io" href="https://forecast7.com/en/40d71n74d01/new-york/?unit=us" data-label_1="NEW YORK"
  data-label_2="WEATHER" data-theme="original">NEW YORK WEATHER</a>
<script>
  !function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = 'https://weatherwidget.io/js/widget.min.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'weatherwidget-io-js');
</script>
<!-- end of weather code -->

  <!--start section of information -->
        <br>
        <div class="row">
          <!--  amount of employees-->
          <div class="col-lg">
          {% if current_location_label != "All Locations" %}
                <div class="jumbotron jumbotron-fluid">
                  <h2 style="text-align: center">Current Employees {{ current_employees }}</h2>
                </div>
          {% else %}
              <div class="jumbotron ">
              <h2 style="text-align: center">Current Employees by location</h2>
                <table class=" table table table-striped table-bordered table-sm">
                  <thead class="thead-dark">
                    <tr>
                      <th scope="col"> Location </th>
                      <th scope="col"> Employees </th>
                    </tr>
                  </thead>
                  <tbody>
                    {%  for location, item in current_working_locations.items %}
                          <tr>
                            <td>{{ location }}</td>
                            <td>{{ item.Name }}</td>
                          </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
          {% endif %}
          </div>
  
          <!--  list of devices-->
          {% if list_of_devices %}
              <div class="col-lg">
                <h5>Devices</h5>
                <table class="table table table-striped table-bordered table-sm">
                  <thead class="tableColor">
                    <tr>
                      <th scope="col">Devices</th>
                      <th scope="col">Quantity</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for device, quantity in list_of_devices.items %}
                    <tr>
                      <td>{{ device }}</td>
                      <td>{{ quantity }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
          {% endif %}
        </div>
  
  
        {% if greater_hours.data %}
          <h5> Irregular Hours </h5>
          <table class="table table table-striped table-bordered  table-sm">
            <thead class="tableColor">
              <tr>
                {% for columns_labels in greater_hours.columns %}
                    <th scope="col">{{ columns_labels }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
                {% for items_in_list in greater_hours.data %}
                  <tr>
                    {% for items in items_in_list %}
                          <td>{{ items }}</td>
                    {% endfor %}
                  </tr>
                {% endfor %}
            </tbody>
          </table>
          <br>
        {% endif%}
  
  
  
    <!-- irregular_entries -->
    {% if irregular_entries %}
      <h5>Irregular Entries </h5>
      <table class="table table table-striped table-bordered  table-sm">
        <thead class="tableColor">
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Department</th>
            <th scope="col">Device Used</th>
            <th scope="col">Time</th>
            <th scope="col">Date</th>
            <th scope="col">Activity</th>
          </tr>
        </thead>
        <tbody>
          {% for data in irregular_entries.values %}
          <tr>
            <td>{{data.Name}}</td>
            <td>{{data.Department}}</td>
            <td>{{data.Device}}</td>
            <td>{{data.Time}}</td>
            <td>{{data.Date}}</td>
            <td>{{data.Activity}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <br>
    {% endif%}
  
  
      {% if warning_not_today_clock_in %}
      <h5>Employees Still 'In' who didn't Clock in today</h5>
      <table class="table table table-striped table-bordered  table-sm"">
        <thead class="tableColor">
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Clock in</th>
            <th scope="col">Device Used</th>
          </tr>
        </thead>
        <tbody>
          {% for data in warning_not_today_clock_in.values %}
          <tr>
            <td>{{ data.Name}}</td>
            <td>{{ data.Date}}</td>
            <td>{{ data.Device}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <br>
      {% endif%}
  
      <!--    list of location for employees working in other places-->
    <div class="row">
      {% if current_not %}
      <div class="col-lg">
      <h5>Employees in other locations </h5>
      <table class="table table table-striped table-bordered table-sm"">
        <thead class="tableColor">
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Primary Department</th>
            <th scope="col">Current Department</th>
          </tr>
        </thead>
        <tbody>
          {% for data in current_not %}
          <tr>
            <td>{{ data.Name }}</td>
            <td>{{ data.Primary_Department }}</td>
            <td>{{ data.Current_Department }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    {% endif %}
  
    {% if primary_not %}
    <div class="col-lg">
    <h5>Employees Visiting your site</h5>
    <table class="table table table-striped table-bordered  table-sm"">
      <thead class="tableColor">
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Primary Department</th>
          <th scope="col">Current Department</th>
        </tr>
      </thead>
      <tbody>
        {% for data in primary_not %}
        <tr>
          <td>{{ data.Name }}</td>
          <td>{{ data.Primary_Department }}</td>
          <td>{{ data.Current_Department }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
  </div>
  {% endif %}
  </div>
  

{% endblock %}
